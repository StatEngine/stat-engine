<!-- TODO:
    - Table should be switched to newer style/format (Bingles)
    - Table and supporting elements need better responsive styling (Bingles)
-->

<div class="incident-search br-mainpanel medium-bg">
  <div class="br-pageheader">
    <nav class="breadcrumb pd-0 mg-0 tx-12">
      <a class="breadcrumb-item" href="index.html">Home</a>
      <a class="breadcrumb-item" href="#">Reports</a>
      <span class="breadcrumb-item active">Incidents</span>
    </nav>
  </div><!-- br-pageheader -->
  <div class="br-pagetitle d-flex justify-content-between flex-wrap">
    <h2 class="m-0">Incidents</h2>
    <div class="input-group wd-300">
      <input
        class="form-control"
        type="text"
        placeholder="Search Incidents"
        ng-model="vm.searchInputValue"
        on-enter-pressed="vm.searchButtonClick()"
      >
      <span class="input-group-btn">
        <button
          class="btn bd-0 btn-primary py-2 px-3 rounded-0"
          type="button"
          ng-click="vm.searchButtonClick()"
        >
          <i class="fa fa-search"></i>
        </button>
      </span>
    </div>
  </div><!-- br-pagetitle -->
  <div class="br-pagebody">
    <section>
      <!-- Incidents (desktop) -->
      <div class="incidents-desktop hidden-lg-down">
        <div
          class="search-grid"
          ui-grid="vm.uiGridOptions"
          ui-grid-resize-column
        >
          <loading-overlay ng-if="vm.isLoading" show-spinner="true"></loading-overlay>
          <h2
            class="watermark heavyheader text-muted"
            ng-show="!vm.isLoading && !vm.uiGridOptions.data.length"
          >
            No data available
          </h2>
        </div>

        <table-controls
          pagination="vm.pagination"
          on-pagination-change="vm.handlePaginationChange({ pagination })"
          position="bottom"
          show-sort="false"
        ></table-controls>
      </div>

      <!-- Incidents (mobile) -->
      <div class="incidents-mobile hidden-xl-up">
        <table-controls
          pagination="vm.pagination"
          sort="vm.sortSelect"
          on-pagination-change="vm.handlePaginationChange({ pagination })"
          on-sort-change="vm.handleSortChange({ sort })"
          is-loading="vm.isLoading"
          position="top"
        ></table-controls>

        <!-- Incidents table -->
        <div class="incidents-mobile-table">
          <loading-overlay ng-if="vm.isLoading" show-spinner="false"></loading-overlay>

          <div
            class="table-row"
            ng-repeat="incident in vm.incidents"
          >
            <div
              class="cell"
              ng-repeat="columnDef in vm.uiGridOptions.columnDefs"
              ng-attr-data-title="{{ columnDef.displayName }}"
            >
              <a
                ng-if="columnDef.field === 'description.incident_number'"
                ng-attr-ui-sref="{{ vm.getIncidentUiSref(incident) }}"
                href="#"
              >
                {{ vm.getIncidentColumn(incident, columnDef) }}
              </a>

              <span ng-if="columnDef.field !== 'description.incident_number'">
                {{ vm.getIncidentColumn(incident, columnDef) }}
              </span>
            </div>
          </div>
        </div>

        <table-controls
          ng-if="!vm.isLoadingFirst"
          pagination="vm.pagination"
          sort="vm.sortSelect"
          on-pagination-change="vm.handlePaginationChange({ pagination })"
          on-sort-change="vm.handleSortChange({ sort })"
          is-loading="vm.isLoading"
          position="bottom"
        ></table-controls>
      </div>
    </section>
  </div>
</div>
